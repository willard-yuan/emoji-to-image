<extends
  src="layout.html"
  locals='{ "exampleName": "Slack colors", "exampleFile": "" }'
>

  
  <block name="content">
    <div id="picker" class="flex flex-center"></div>
  </block>
  
  <block name="header_after">
    <!-- Search container -->
    <div class="search-container" role="search" aria-label="Emoji search">
      <div class="search-wrapper">
        <input type="text" id="emoji-search" placeholder="Search emojis..." aria-label="Search for emojis" title="Type emoji name like smile, heart, or labubu" />
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
    </div>
    <div class="hot-search" aria-label="Popular emoji searches">
      <span>hotğŸ”¥: </span>
      <a href="?=labubu" title="Search for Labubu emojis" aria-label="Search for Labubu emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">labubu</a>
      <a href="?=smile" title="Search for smile emojis" aria-label="Search for smile emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">smile</a>
      <a href="?=food" title="Search for food emojis" aria-label="Search for food emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">food</a>
      <a href="?=heart" title="Search for heart emojis" aria-label="Search for heart emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">heart</a>
      <a href="?=music" title="Search for music emojis" aria-label="Search for music emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">music</a>
    </div>
  </block>

  <block name="script">
    <style>
      /* æœç´¢æ¡†æ ·å¼ */
      .search-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0.5rem auto 1.5rem;
        padding: 0 2rem;
        max-width: 600px;
      }
      
      .search-wrapper {
        position: relative;
        width: 100%;
        max-width: 450px;
        display: flex;
        align-items: center;
      }
      
      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        color: #6b7280;
        pointer-events: none;
        z-index: 1;
      }
      
      .search-container input {
        width: 100%;
        padding: 14px 20px 14px 48px;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        font-size: 16px;
        background-color: #ffffff;
        color: var(--color);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      .search-container input:focus {
        outline: none;
        border-color: #6772e5;
        box-shadow: 0 0 0 4px rgba(103, 114, 229, 0.15), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .search-container input:focus + .search-icon {
        color: #6772e5;
      }
      
      .search-container input::placeholder {
        color: #9ca3af;
        font-weight: 400;
      }
      
      .search-container input:hover {
        border-color: #d1d5db;
        box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
      }
      
      /* éšè—emoji-martå†…ç½®çš„æœç´¢æ¡† */
      em-emoji-picker .emoji-mart-search {
        display: none !important;
      }
      
      em-emoji-picker .emoji-mart-search-icon {
        display: none !important;
      }
    </style>
    <script type="module">
      import data from '@emoji-mart/data'
      import { Picker } from 'emoji-mart'

      import labubu1 from './assets/labubu_emoji_1.png'
      import labubu2 from './assets/labubu_emoji_2.png'
      import labubu3 from './assets/labubu_emoji_3.png'
      import labubu4 from './assets/labubu_emoji_4.png'
      import labubu5 from './assets/labubu_emoji_5.png'
      import labubu6 from './assets/labubu_emoji_6.png'
      import labubu7 from './assets/labubu_emoji_7.png'
      import labubu8 from './assets/labubu_emoji_8.png'

      // Import all image assets to ensure they are processed by Parcel
      import labubu1_64 from './assets/labubu_emoji_1_64x64.png'
      import labubu1_128 from './assets/labubu_emoji_1_128x128.png'
      import labubu1_256 from './assets/labubu_emoji_1_256x256.png'
      import labubu1_512 from './assets/labubu_emoji_1_512x512.png'
      import labubu2_64 from './assets/labubu_emoji_2_64x64.png'
      import labubu2_128 from './assets/labubu_emoji_2_128x128.png'
      import labubu2_256 from './assets/labubu_emoji_2_256x256.png'
      import labubu2_512 from './assets/labubu_emoji_2_512x512.png'
      import labubu3_64 from './assets/labubu_emoji_3_64x64.png'
      import labubu3_128 from './assets/labubu_emoji_3_128x128.png'
      import labubu3_256 from './assets/labubu_emoji_3_256x256.png'
      import labubu3_512 from './assets/labubu_emoji_3_512x512.png'
      import labubu4_64 from './assets/labubu_emoji_4_64x64.png'
      import labubu4_128 from './assets/labubu_emoji_4_128x128.png'
      import labubu4_256 from './assets/labubu_emoji_4_256x256.png'
      import labubu4_512 from './assets/labubu_emoji_4_512x512.png'
      import labubu5_64 from './assets/labubu_emoji_5_64x64.png'
      import labubu5_128 from './assets/labubu_emoji_5_128x128.png'
      import labubu5_256 from './assets/labubu_emoji_5_256x256.png'
      import labubu5_512 from './assets/labubu_emoji_5_512x512.png'
      import labubu6_64 from './assets/labubu_emoji_6_64x64.png'
      import labubu6_128 from './assets/labubu_emoji_6_128x128.png'
      import labubu6_256 from './assets/labubu_emoji_6_256x256.png'
      import labubu6_512 from './assets/labubu_emoji_6_512x512.png'
      import labubu7_64 from './assets/labubu_emoji_7_64x64.png'
      import labubu7_128 from './assets/labubu_emoji_7_128x128.png'
      import labubu7_256 from './assets/labubu_emoji_7_256x256.png'
      import labubu7_512 from './assets/labubu_emoji_7_512x512.png'
      import labubu8_64 from './assets/labubu_emoji_8_64x64.png'
      import labubu8_128 from './assets/labubu_emoji_8_128x128.png'
      import labubu8_256 from './assets/labubu_emoji_8_256x256.png'
      import labubu8_512 from './assets/labubu_emoji_8_512x512.png'

      let selectedEmoji = null
      let selectedEmojiName = 'art'
      let currentSize = 512 // Default size
      
      // åˆ›å»ºè‡ªå®šä¹‰åˆ†ç±»å’Œè¡¨æƒ…ç¬¦å·
      const custom = [
        {
          id: 'labubu_category',
          name: 'Labubu',
          emojis: [

            {
              id: 'labubu1',
              name: 'Labubu 1',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu1,
                downloads: {
                  '64': labubu1_64,
                  '128': labubu1_128,
                  '256': labubu1_256,
                  '512': labubu1_512,
                },
              }],
            },
            {
              id: 'labubu2',
              name: 'Labubu 2',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu2,
                downloads: {
                  '64': labubu2_64,
                  '128': labubu2_128,
                  '256': labubu2_256,
                  '512': labubu2_512,
                },
              }],
            },
            {
              id: 'labubu3',
              name: 'Labubu 3',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu3,
                downloads: {
                  '64': labubu3_64,
                  '128': labubu3_128,
                  '256': labubu3_256,
                  '512': labubu3_512,
                },
              }],
            },
             {
               id: 'labubu4',
               name: 'Labubu 4',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu4,
                 downloads: {
                   '64': labubu4_64,
                   '128': labubu4_128,
                   '256': labubu4_256,
                   '512': labubu4_512,
                 },
               }],
             },
             {
               id: 'labubu5',
               name: 'Labubu 5',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu5,
                 downloads: {
                   '64': labubu5_64,
                   '128': labubu5_128,
                   '256': labubu5_256,
                   '512': labubu5_512,
                 },
               }],
             },
             {
               id: 'labubu6',
               name: 'Labubu 6',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu6,
                 downloads: {
                   '64': labubu6_64,
                   '128': labubu6_128,
                   '256': labubu6_256,
                   '512': labubu6_512,
                 },
               }],
             },
             {
               id: 'labubu7',
               name: 'Labubu 7',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu7,
                 downloads: {
                   '64': labubu7_64,
                   '128': labubu7_128,
                   '256': labubu7_256,
                   '512': labubu7_512,
                 },
               }],
             },
             {
               id: 'labubu8',
               name: 'Labubu 8',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu8,
                 downloads: {
                   '64': labubu8_64,
                   '128': labubu8_128,
                   '256': labubu8_256,
                   '512': labubu8_512,
                 },
               }],
             },

          ]
        }
      ]
      
      const picker = new Picker({
        parent: document.querySelector('#picker'),
        data: data,
        custom: custom,
        categories: ['labubu_category', 'frequent', 'people', 'nature', 'foods', 'activity', 'places', 'objects', 'symbols', 'flags'],
        emojiButtonRadius: '6px',
        emojiButtonColors: [
          'rgba(155,223,88,.7)',
          'rgba(149,211,254,.7)',
          'rgba(247,233,34,.7)',
          'rgba(238,166,252,.7)',
          'rgba(255,213,143,.7)',
          'rgba(211,209,255,.7)',
        ],
        onEmojiSelect: onEmojiSelect,
      })

      function generateEmojiImage(emoji, size) {
        // å¤„ç†è‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·
        if (emoji && emoji.skins && emoji.skins[0] && emoji.skins[0].src) {
          // åˆ›å»ºä¸€ä¸ªä¸´æ—¶å›¾åƒå…ƒç´ æ¥åŠ è½½è‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·
          return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = size;
              canvas.height = size;
              
              // è®¾ç½®é«˜è´¨é‡æ¸²æŸ“
              ctx.imageSmoothingEnabled = true;
              ctx.imageSmoothingQuality = 'high';
              
              // æ¸…é™¤ç”»å¸ƒï¼Œè®¾ç½®é€æ˜èƒŒæ™¯
              ctx.clearRect(0, 0, size, size);
              
              // ç»˜åˆ¶è¡¨æƒ…ç¬¦å·å›¾åƒ
              ctx.drawImage(img, 0, 0, size, size);
              
              resolve(canvas.toDataURL('image/png'));
            };
            img.onerror = () => {
              // å¦‚æœå›¾åƒåŠ è½½å¤±è´¥ï¼Œåˆ™è¿”å›é»˜è®¤å›¾åƒ
              resolve('./assets/labubu_emoji_256x256.png');
            };
            img.src = emoji.skins[0].src;
          });
        }
        
        // å¤„ç†æ ‡å‡†è¡¨æƒ…ç¬¦å·
        if (emoji && emoji.native) {
          const canvas = document.createElement('canvas')
          const ctx = canvas.getContext('2d')
          canvas.width = size
          canvas.height = size
          
          // Set high-quality rendering
          ctx.imageSmoothingEnabled = true
          ctx.imageSmoothingQuality = 'high'
          
          // Use appropriate font size for the canvas size
          ctx.font = `${size * 0.8}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", Arial`
          ctx.textAlign = 'center'
          ctx.textBaseline = 'middle'
          
          // Clear canvas with transparent background
          ctx.clearRect(0, 0, size, size)
          
          // Draw emoji
          ctx.fillText(emoji.native, size / 2, size / 2)
          
          return canvas.toDataURL('image/png')
        }
        return './assets/labubu_emoji_256x256.png'
      }

      function onEmojiSelect(emoji) {
        const downloadBtn = document.getElementById('download-btn')

        if (emoji) {
          // Find the full emoji object from our custom list, as emoji-mart strips extra properties.
          let fullEmojiObject = null
          for (const category of custom) {
            const found = category.emojis.find(
              (customEmoji) => customEmoji.id === emoji.id,
            )
            if (found) {
              fullEmojiObject = found
              break
            }
          }

          // If it's a custom emoji, use our full object which includes the 'downloads' property.
          // Otherwise, use the object from emoji-mart (for standard emojis).
          selectedEmoji = fullEmojiObject || emoji

          selectedEmojiName = (emoji.id || emoji.name || 'emoji').replace(/ /g, '_')
          downloadBtn.disabled = false
        } else {
          selectedEmoji = null
          selectedEmojiName = ''
          downloadBtn.disabled = true
        }
        updatePreview()
      }

      function updatePreview() {
        const previewImg = document.getElementById('preview-image')
        const downloadBtn = document.getElementById('download-btn')
        const downloadSpan = downloadBtn.querySelector('span')
        const sizeSelect = document.getElementById('size-select')

        currentSize = parseInt(sizeSelect.value)

        if (selectedEmoji) {
          previewImg.style.width = `${currentSize}px`
          previewImg.style.height = `${currentSize}px`
          // æ›´æ–°altå’Œtitleå±æ€§ä»¥æé«˜SEOå’Œæ— éšœç¢æ€§
          const emojiName = selectedEmoji.name || selectedEmojiName || 'emoji';
          previewImg.alt = `${emojiName} emoji preview at ${currentSize}x${currentSize} pixels`;
          previewImg.title = `${emojiName} emoji - Click download button to save as PNG`;
          
          if (selectedEmoji.skins && selectedEmoji.skins[0] && selectedEmoji.skins[0].downloads && selectedEmoji.skins[0].downloads[currentSize]) {
            previewImg.src = selectedEmoji.skins[0].downloads[currentSize];
          } else if (selectedEmoji.skins && selectedEmoji.skins[0] && selectedEmoji.skins[0].src) {
            previewImg.src = selectedEmoji.skins[0].src
          } else {
            const imageResult = generateEmojiImage(selectedEmoji, currentSize)
            if (imageResult instanceof Promise) {
              imageResult.then((imageData) => {
                previewImg.src = imageData
              }).catch(() => {
                previewImg.src = './assets/labubu_emoji_256x256.png'
              })
            } else {
              previewImg.src = imageResult
            }
          }
          downloadSpan.textContent = `Download ${selectedEmojiName}_${currentSize}x${currentSize}.png`
          downloadBtn.disabled = false
          downloadBtn.setAttribute('aria-label', `Download ${selectedEmojiName} emoji as ${currentSize}x${currentSize} PNG image`)
          downloadBtn.title = `Download ${selectedEmojiName} emoji as ${currentSize}x${currentSize} PNG image`
        } else {
          previewImg.src = ''
          previewImg.alt = 'Select an emoji to preview'
          previewImg.title = 'No emoji selected yet'
          previewImg.style.width = 'auto'
          previewImg.style.height = 'auto'
          downloadSpan.textContent = 'Download'
          downloadBtn.disabled = true
          downloadBtn.setAttribute('aria-label', 'Download button (select an emoji first)')
          downloadBtn.title = 'Select an emoji first'
        }
      }

      // Initialize button text on page load
      document.addEventListener('DOMContentLoaded', () => {
        const previewImg = document.getElementById('preview-image')
        const downloadBtn = document.getElementById('download-btn')
        const downloadSpan = downloadBtn.querySelector('span')
        const sizeSelect = document.getElementById('size-select')
        const searchInput = document.getElementById('emoji-search')
        currentSize = parseInt(sizeSelect.value)

        // æ£€æŸ¥ URL ä¸­æ˜¯å¦æœ‰æœç´¢å‚æ•°
        const searchString = window.location.search
        let searchQuery = ''
        
        // å¤„ç† ?=å…³é”®è¯ æ ¼å¼çš„ URL
        if (searchString.startsWith('?=')) {
          searchQuery = decodeURIComponent(searchString.substring(2))
          
          if (searchQuery) {
            // è®¾ç½®æœç´¢æ¡†çš„å€¼
            searchInput.value = searchQuery
            // è§¦å‘æœç´¢å¹¶è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª emoji
            triggerSearch(searchQuery)
          }
        }
        
        // Set the initial emoji to Labubu 1
        selectedEmoji = custom[0].emojis[0];
        selectedEmojiName = selectedEmoji.id;

        // Update the preview to show the default emoji with the correct size
        updatePreview();

        previewImg.alt = 'Select an emoji to preview'
        if (selectedEmojiName) {
          downloadSpan.textContent = `Download ${selectedEmojiName}_${currentSize}x${currentSize}.png`
          downloadBtn.disabled = false
        } else {
          downloadSpan.textContent = 'Download'
          downloadBtn.disabled = true
        }
      })

      // Size selector change handler
      document.getElementById('size-select').addEventListener('change', updatePreview)

      // Download functionality
      document.getElementById('download-btn').addEventListener('click', () => {
        const sizeSelect = document.getElementById('size-select')
        const selectedSize = parseInt(sizeSelect.value)

        const processDownload = (imageData) => {
          const link = document.createElement('a')
          link.download = `${selectedEmojiName}_${selectedSize}x${selectedSize}.png`
          link.href = imageData
          link.click()
        }

        if (selectedEmoji) {
          if (
            selectedEmoji.skins &&
            selectedEmoji.skins[0] &&
            selectedEmoji.skins[0].downloads &&
            selectedEmoji.skins[0].downloads[selectedSize]
          ) {
            processDownload(selectedEmoji.skins[0].downloads[selectedSize])
          } else {
            // Fallback for other emojis or sizes not specified
            const imageResult = generateEmojiImage(selectedEmoji, selectedSize)
            if (imageResult instanceof Promise) {
              imageResult.then(processDownload)
            } else {
              processDownload(imageResult)
            }
          }
        } else {
          // Use default image
          processDownload('./assets/labubu_emoji_256x256.png')
        }
      })

      // æœç´¢åŠŸèƒ½ - å¢å¼ºç‰ˆï¼Œæ”¯æŒæ— éšœç¢è®¿é—®å’ŒSEOä¼˜åŒ–
      const searchInput = document.getElementById('emoji-search')
      
      // æ·»åŠ ARIAå±æ€§ä»¥æé«˜æ— éšœç¢æ€§
      searchInput.setAttribute('aria-controls', 'picker')
      searchInput.setAttribute('aria-autocomplete', 'list')
      
      // æ¨¡æ‹Ÿemoji-martå†…éƒ¨æœç´¢è¾“å…¥å¹¶è·å–ç¬¬ä¸€ä¸ªæœç´¢ç»“æœä½œä¸ºé¢„è§ˆ
      const triggerSearch = (searchTerm) => {
        // æ›´æ–°é¡µé¢æ ‡é¢˜ä»¥åæ˜ æœç´¢çŠ¶æ€ï¼Œæœ‰åˆ©äºSEO
        if (searchTerm) {
          document.title = `${searchTerm} Emoji - Search Results | EmojiToImage.com`
        } else {
          document.title = `Emoji To Image - Search An Emoji and Convert It As An Image.`
        }
        
        const pickerElement = document.querySelector('em-emoji-picker')
        if (pickerElement && pickerElement.shadowRoot) {
          const internalSearchInput = pickerElement.shadowRoot.querySelector('input[type="search"]')
          if (internalSearchInput) {
            internalSearchInput.value = searchTerm
            // è§¦å‘inputäº‹ä»¶
            const inputEvent = new Event('input', { bubbles: true })
            internalSearchInput.dispatchEvent(inputEvent)
            
            // æ·»åŠ å»¶æ—¶ä»¥ç¡®ä¿æœç´¢ç»“æœå·²æ›´æ–°
            setTimeout(() => {
              // è·å–æœç´¢ç»“æœä¸­çš„ç¬¬ä¸€ä¸ªemoji
              const firstEmojiButton = pickerElement.shadowRoot.querySelector('.emoji-mart-emoji')
              if (firstEmojiButton && searchTerm) {
                // æ”¾å¤§æ˜¾ç¤ºç¬¬ä¸€ä¸ªemoji
                firstEmojiButton.style.transform = 'scale(1.3)';
                
                // 2ç§’åæ¢å¤æ­£å¸¸æ ·å¼
                setTimeout(() => {
                  firstEmojiButton.style.transform = '';
                }, 2000);
                
                // è·å–emojiæ•°æ®
                const emojiId = firstEmojiButton.getAttribute('data-emoji-id')
                const emojiName = firstEmojiButton.getAttribute('data-emoji-name')
                
                // æŸ¥æ‰¾å®Œæ•´çš„emojiå¯¹è±¡
                let foundEmoji = null
                
                // é¦–å…ˆåœ¨è‡ªå®šä¹‰emojiä¸­æŸ¥æ‰¾
                for (const category of custom) {
                  const found = category.emojis.find(
                    (customEmoji) => customEmoji.id === emojiId || customEmoji.name === emojiName
                  )
                  if (found) {
                    foundEmoji = found
                    break
                  }
                }
                
                // å¦‚æœåœ¨è‡ªå®šä¹‰emojiä¸­æ²¡æ‰¾åˆ°ï¼Œåˆ™å¯èƒ½æ˜¯æ ‡å‡†emoji
                if (!foundEmoji) {
                  // æ¨¡æ‹Ÿç‚¹å‡»ç¬¬ä¸€ä¸ªemojiä»¥è·å–å…¶æ•°æ®
                  firstEmojiButton.click()
                  return
                }
                
                // è®¾ç½®ä¸ºé€‰ä¸­çš„emojiå¹¶æ›´æ–°é¢„è§ˆ
                onEmojiSelect(foundEmoji)
              }
            }, 300) // 300mså»¶æ—¶ä»¥ç¡®ä¿æœç´¢ç»“æœå·²æ›´æ–°
          }
        }
      }
      
      searchInput.addEventListener('input', function(event) {
        const searchTerm = event.target.value
        triggerSearch(searchTerm)
        
        // æ›´æ–° URLï¼Œåœ¨ URL åé¢æ·»åŠ  ?=å…³é”®è¯
        const newUrl = searchTerm
          ? `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}` 
          : `${window.location.origin}${window.location.pathname}`
        window.history.replaceState({}, '', newUrl)
      })
      
      // æ¸…é™¤æœç´¢æ—¶é‡ç½®
      searchInput.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          event.target.value = ''
          triggerSearch('')
          // é‡ç½® URL
          window.history.replaceState({}, '', `${window.location.origin}${window.location.pathname}`)
        }
      })
      
      // æ·»åŠ çƒ­é—¨æœç´¢é“¾æ¥çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨ - ä¿®å¤ç§»åŠ¨ç«¯ç‚¹å‡»æ— å“åº”é—®é¢˜
      document.querySelectorAll('.hot-search a').forEach(link => {
        // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒç§»åŠ¨ç«¯
        link.addEventListener('touchstart', function(event) {
          // é˜²æ­¢è§¦æ‘¸æ—¶çš„é»˜è®¤è¡Œä¸º
          event.preventDefault()
        })
        
        link.addEventListener('click', function(event) {
          event.preventDefault() // é˜²æ­¢é¡µé¢é‡æ–°åŠ è½½
          
          const href = this.getAttribute('href')
          const searchTerm = href.startsWith('?=') ? decodeURIComponent(href.substring(2)) : ''
          
          if (searchTerm) {
            // è®¾ç½®æœç´¢æ¡†çš„å€¼
            searchInput.value = searchTerm
            // è§¦å‘æœç´¢
            triggerSearch(searchTerm)
            // æ›´æ–° URL
            const newUrl = `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}`
            window.history.replaceState({}, '', newUrl)
          }
        })
        
        // æ·»åŠ è§¦æ‘¸ç»“æŸäº‹ä»¶å¤„ç†
        link.addEventListener('touchend', function(event) {
          event.preventDefault()
          // è§¦å‘ç‚¹å‡»äº‹ä»¶
          this.click()
        })
      })
    </script>
  </block>
</extends>
