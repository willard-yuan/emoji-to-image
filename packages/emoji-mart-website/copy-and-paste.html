<extends
  src="layout.html"
  locals='{ "exampleName": "Emoji to Copy", "exampleFile": "copy-and-paste.html" }'
>
  <block name="download_section"></block>

  <block name="header_after">
    <div class="search-container">
      <div class="search-wrapper">
        <input type="text" id="emoji-search" placeholder="Search emojis..." />
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
    </div>
    <div class="hot-search">
      <span>hotğŸ”¥: </span>
      <a href="?=smile" class="hot-search-link" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">smile</a>
      <a href="?=heart" class="hot-search-link" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">heart</a>
      <a href="?=music" class="hot-search-link" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">music</a>
      <a href="?=food" class="hot-search-link" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">food</a>
    </div>
  </block>

  <block name="content">
    <div class="main-content">
      <div class="picker-section" id="picker-section">
        <div id="picker"></div>
      </div>
    </div>
  </block>

  <block name="script">
    <style>
      /* å•åˆ—å¸ƒå±€è¦†ç›– */
      .main-content {
        display: block;
        grid-template-columns: none;
        gap: 2rem;
      }
      
      .picker-section {
        padding: 1rem 0;
        margin-top: 0.5rem;
        position: relative;
      }
      
      em-emoji-picker {
        /* Mobile-first responsive styles */
        width: 100%;
        max-width: 100%;
        min-width: 250px;
        resize: horizontal;
        overflow: auto;
        margin: 0 auto;
      }

      /* è‡ªå®šä¹‰emojiæ ·å¼ï¼Œä½¿å…¶æ›´å¤§æ°”ç¾è§‚ */
      em-emoji-picker .emoji-mart-emoji {
        transform: scale(1.2);
        margin: 0.2em;
      }

      /* ç¡®ä¿emojiåœ¨æ‚¬åœæ—¶æœ‰æ˜æ˜¾çš„è§†è§‰åé¦ˆ */
      em-emoji-picker .emoji-mart-emoji:hover {
        transform: scale(1.4);
        transition: transform 0.2s ease;
      }

      @media (min-width: 820px) {
        em-emoji-picker {
          width: auto;
          min-width: 800px;
        }
      }
      
      /* æœç´¢æ¡†ç§»åŠ¨åˆ°æ ‡é¢˜ä¸‹æ–¹å±…ä¸­ */
      .search-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 1rem auto 1.5rem;
        padding: 0 2rem;
        max-width: 600px;
      }
      
      .search-wrapper {
        position: relative;
        width: 100%;
        max-width: 450px;
        display: flex;
        align-items: center;
      }
      
      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        color: #6b7280;
        pointer-events: none;
        z-index: 1;
      }
      
      .search-container input {
        width: 100%;
        padding: 14px 20px 14px 48px;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        font-size: 16px;
        background-color: #ffffff;
        color: var(--color);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      .search-container input:focus {
        outline: none;
        border-color: #6772e5;
        box-shadow: 0 0 0 4px rgba(103, 114, 229, 0.15), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .search-container input:focus + .search-icon {
        color: #6772e5;
      }
      
      .search-container input::placeholder {
        color: #9ca3af;
        font-weight: 400;
      }
      
      .search-container input:hover {
        border-color: #d1d5db;
        box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
      }
      
      /* éšè—emoji-martå†…ç½®çš„æœç´¢æ¡† */
      em-emoji-picker .emoji-mart-search {
        display: none !important;
      }
      
      em-emoji-picker .emoji-mart-search-icon {
        display: none !important;
      }

      /* å¤åˆ¶æç¤ºæ¡†æ ·å¼ */
      .copied-toast {
        position: absolute;
        background-color: #6772e5;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(103, 114, 229, 0.3);
        font-size: 16px;
        font-weight: 500;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        transform: translateY(10px);
      }
    </style>
    <script type="module">
      import data from '@emoji-mart/data'
      import { Picker } from 'emoji-mart'

      // åˆ›å»ºå¤åˆ¶æç¤ºæ¡†å…ƒç´ 
      const createCopiedToast = () => {
        const toast = document.createElement('div');
        toast.className = 'copied-toast';
        toast.innerHTML = 'âœ“ Copied!';
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(10px)';
        document.querySelector('.picker-section').appendChild(toast);
        return toast;
      };
      
      // æ˜¾ç¤ºå¤åˆ¶æç¤ºæ¡†
      const showCopiedToast = (toast, x, y) => {
        const pickerSection = document.querySelector('.picker-section');
        const rect = pickerSection.getBoundingClientRect();

        // è®¡ç®—ç›¸å¯¹äº.picker-sectionçš„åæ ‡
        const relativeX = x - rect.left;
        const relativeY = y - rect.top;

        // å°†æç¤ºæ¡†å±…ä¸­åœ¨ç‚¹å‡»ä½ç½®ä¸Šæ–¹
        toast.style.left = `${relativeX - toast.offsetWidth / 2}px`;
        toast.style.top = `${relativeY - toast.offsetHeight - 20}px`; // åœ¨ä¸Šæ–¹ç•™å‡º20pxçš„é—´è·
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)'; // é‡ç½®transformï¼Œå®ç°å¼¹å‡ºåŠ¨ç”»
        
        // 2ç§’åéšè—
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(10px)';
        }, 2000);
      };
      
      // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
      const copyToClipboard = async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          return false;
        }
      };
      
      document.addEventListener('DOMContentLoaded', function() {
        // ä¿®æ”¹é¡µé¢æ ‡é¢˜å’Œæè¿°
        const h1 = document.querySelector('h1');
        if (h1) {
          h1.textContent = 'Emoji to Copy & Paste';
        }

        const p = document.querySelector('header p');
        if (p) {
          p.innerHTML = 'Search for trending emojis using keywords like <a href="?=smile" class="hot-search-link" style="background-color: #f5f5f5; padding: 3px 6px; border-radius: 4px; text-decoration: none; color: inherit; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor=\'#e0e0ff\'; this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.1)\'" onmouseout="this.style.backgroundColor=\'#f5f5f5\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'none\'">smile</a>, <a href="?=heart" class="hot-search-link" style="background-color: #f5f5f5; padding: 3px 6px; border-radius: 4px; text-decoration: none; color: inherit; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor=\'#e0e0ff\'; this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.1)\'" onmouseout="this.style.backgroundColor=\'#f5f5f5\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'none\'">heart</a>, or <a href="?=music" class="hot-search-link" style="background-color: #f5f5f5; padding: 3px 6px; border-radius: 4px; text-decoration: none; color: inherit; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor=\'#e0e0ff\'; this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.1)\'" onmouseout="this.style.backgroundColor=\'#f5f5f5\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'none\'">music</a> - instantly copy your favorite emoji with a single click and paste it anywhere! Express yourself with the perfect emoji in seconds!';
        }
        
        // åˆ›å»ºå¤åˆ¶æç¤ºæ¡†
        const copiedToast = createCopiedToast();
        
        // è·Ÿè¸ªæœ€åç‚¹å‡»çš„ä½ç½®
        let lastClickX = 0;
        let lastClickY = 0;
        
        // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨æ¥æ•è·ç‚¹å‡»ä½ç½®
        document.addEventListener('click', function(event) {
          lastClickX = event.clientX;
          lastClickY = event.clientY;
        }, true); // ä½¿ç”¨æ•è·é˜¶æ®µä»¥ç¡®ä¿åœ¨å…¶ä»–å¤„ç†ç¨‹åºä¹‹å‰æ‰§è¡Œ
        
        // åˆå§‹åŒ–emojié€‰æ‹©å™¨
        const picker = new Picker({
          parent: document.querySelector('#picker'),
          data: data,
          dynamicWidth: true,
          emojiSize: 28, // å¢å¤§emojiçš„å°ºå¯¸
          emojiButtonRadius: '8px', // å¢åŠ æŒ‰é’®åœ†è§’
          emojiButtonColors: [
            'rgba(155,223,88,.7)',
            'rgba(149,211,254,.7)',
            'rgba(247,233,34,.7)',
            'rgba(238,166,252,.7)',
            'rgba(255,213,143,.7)',
            'rgba(211,209,255,.7)',
          ],
          onEmojiSelect: async (emoji) => {
            // å¤åˆ¶emojiåˆ°å‰ªè´´æ¿
            const success = await copyToClipboard(emoji.native || emoji.id);
            
            if (success) {
              // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤ºåœ¨æœ€åç‚¹å‡»çš„ä½ç½®
              showCopiedToast(copiedToast, lastClickX, lastClickY);
            }
          }
        });
        
        // è¿æ¥è‡ªå®šä¹‰æœç´¢æ¡†ä¸emoji-martæœç´¢åŠŸèƒ½
        const searchInput = document.getElementById('emoji-search');
        
        // æ¨¡æ‹Ÿemoji-martå†…éƒ¨æœç´¢è¾“å…¥å¹¶è·å–ç¬¬ä¸€ä¸ªæœç´¢ç»“æœ
        const triggerSearch = (searchTerm) => {
          const pickerElement = document.querySelector('em-emoji-picker');
          if (pickerElement && pickerElement.shadowRoot) {
            const internalSearchInput = pickerElement.shadowRoot.querySelector('input[type="search"]');
            if (internalSearchInput) {
              internalSearchInput.value = searchTerm;
              // è§¦å‘inputäº‹ä»¶
              const inputEvent = new Event('input', { bubbles: true });
              internalSearchInput.dispatchEvent(inputEvent);
              
              // æ·»åŠ å»¶æ—¶ä»¥ç¡®ä¿æœç´¢ç»“æœå·²æ›´æ–°
              if (searchTerm) {
                setTimeout(() => {
                  // è·å–æœç´¢ç»“æœä¸­çš„ç¬¬ä¸€ä¸ªemoji
                  const firstEmojiButton = pickerElement.shadowRoot.querySelector('.emoji-mart-emoji');
                  if (firstEmojiButton) {
                    // æ”¾å¤§æ˜¾ç¤ºç¬¬ä¸€ä¸ªemojiï¼Œä½†ä¸æ·»åŠ è¾¹æ¡†
                    firstEmojiButton.style.transform = 'scale(1.3)';
                    
                    // 2ç§’åæ¢å¤æ­£å¸¸æ ·å¼
                    setTimeout(() => {
                      firstEmojiButton.style.transform = '';
                    }, 2000);
                  }
                }, 300); // 300mså»¶æ—¶ä»¥ç¡®ä¿æœç´¢ç»“æœå·²æ›´æ–°
              }
            }
          }
        };
        
        // æ£€æŸ¥ URL ä¸­æ˜¯å¦æœ‰æœç´¢å‚æ•°
        const searchString = window.location.search;
        let searchQuery = '';
        
        // å¤„ç† ?=å…³é”®è¯ æ ¼å¼çš„ URL
        if (searchString.startsWith('?=')) {
          searchQuery = decodeURIComponent(searchString.substring(2));
          
          if (searchQuery) {
            // è®¾ç½®æœç´¢æ¡†çš„å€¼
            searchInput.value = searchQuery;
            // è§¦å‘æœç´¢å¹¶è‡ªåŠ¨é«˜äº®ç¬¬ä¸€ä¸ª emoji
            triggerSearch(searchQuery);
          }
        }
        
        searchInput.addEventListener('input', function(event) {
          const searchTerm = event.target.value;
          triggerSearch(searchTerm);
          
          // æ›´æ–° URLï¼Œåœ¨ URL åé¢æ·»åŠ  ?=å…³é”®è¯
          const newUrl = searchTerm
            ? `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}` 
            : `${window.location.origin}${window.location.pathname}`;
          window.history.replaceState({}, '', newUrl);
        });
        
        // æ¸…é™¤æœç´¢æ—¶é‡ç½®
        searchInput.addEventListener('keydown', function(event) {
          if (event.key === 'Escape') {
            event.target.value = '';
            triggerSearch('');
            // é‡ç½® URL
            window.history.replaceState({}, '', `${window.location.origin}${window.location.pathname}`);
          }
        });
        
        // æ·»åŠ çƒ­é—¨æœç´¢é“¾æ¥çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨
         document.querySelectorAll('.hot-search-link').forEach(link => {
            link.addEventListener('click', function(event) {
              event.preventDefault(); // é˜²æ­¢é¡µé¢é‡æ–°åŠ è½½
              
              const href = this.getAttribute('href');
              const searchTerm = href.startsWith('?=') ? decodeURIComponent(href.substring(2)) : '';
              
              if (searchTerm) {
                // è®¾ç½®æœç´¢æ¡†çš„å€¼
                searchInput.value = searchTerm;
                // è§¦å‘æœç´¢
                triggerSearch(searchTerm);
                // æ›´æ–° URL
                const newUrl = `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}`;
                window.history.replaceState({}, '', newUrl);
              }
            });
          });
      });
    </script>
  </block>
</extends>
