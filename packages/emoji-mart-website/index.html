<extends
  src="layout.html"
  locals='{ "exampleName": "Slack colors", "exampleFile": "" }'
>

  
  <block name="content">
    <div id="picker" class="flex flex-center"></div>
  </block>
  
  <block name="header_after">
    <!-- Search container -->
    <div class="search-container" role="search" aria-label="Emoji search">
      <div class="search-wrapper">
        <input type="text" id="emoji-search" placeholder="Search emojis..." aria-label="Search for emojis" title="Type emoji name like smile, heart, or labubu" />
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
    </div>
    <div class="hot-search" aria-label="Popular emoji searches">
      <span>hotüî•: </span>
      <a href="?=labubu" title="Search for Labubu emojis" aria-label="Search for Labubu emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">labubu</a>
      <a href="?=smile" title="Search for smile emojis" aria-label="Search for smile emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">smile</a>
      <a href="?=food" title="Search for food emojis" aria-label="Search for food emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">food</a>
      <a href="?=heart" title="Search for heart emojis" aria-label="Search for heart emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">heart</a>
      <a href="?=music" title="Search for music emojis" aria-label="Search for music emojis" style="background-color: #f5f5f5; padding: 4px 8px; border-radius: 4px; text-decoration: none; color: inherit; margin-right: 8px; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#ffe0e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='#f5f5f5'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">music</a>
    </div>
  </block>

  <block name="script">
    <style>
      /* ÊêúÁ¥¢Ê°ÜÊ†∑Âºè */
      .search-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0.5rem auto 1.5rem;
        padding: 0 2rem;
        max-width: 600px;
      }
      
      .search-wrapper {
        position: relative;
        width: 100%;
        max-width: 450px;
        display: flex;
        align-items: center;
      }
      
      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        color: #6b7280;
        pointer-events: none;
        z-index: 1;
      }
      
      .search-container input {
        width: 100%;
        padding: 14px 20px 14px 48px;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        font-size: 16px;
        background-color: #ffffff;
        color: var(--color);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      .search-container input:focus {
        outline: none;
        border-color: #6772e5;
        box-shadow: 0 0 0 4px rgba(103, 114, 229, 0.15), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .search-container input:focus + .search-icon {
        color: #6772e5;
      }
      
      .search-container input::placeholder {
        color: #9ca3af;
        font-weight: 400;
      }
      
      .search-container input:hover {
        border-color: #d1d5db;
        box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
      }
      
      /* ÈöêËóèemoji-martÂÜÖÁΩÆÁöÑÊêúÁ¥¢Ê°Ü */
      em-emoji-picker .emoji-mart-search {
        display: none !important;
      }
      
      em-emoji-picker .emoji-mart-search-icon {
        display: none !important;
      }
    </style>
    <script type="module">
      import data from '@emoji-mart/data'
      import { Picker } from 'emoji-mart'

      import labubu1 from './assets/labubu_emoji_1.png'
      import labubu2 from './assets/labubu_emoji_2.png'
      import labubu3 from './assets/labubu_emoji_3.png'
      import labubu4 from './assets/labubu_emoji_4.png'
      import labubu5 from './assets/labubu_emoji_5.png'
      import labubu6 from './assets/labubu_emoji_6.png'
      import labubu7 from './assets/labubu_emoji_7.png'
      import labubu8 from './assets/labubu_emoji_8.png'

      // Import all image assets to ensure they are processed by Parcel
      import labubu1_64 from './assets/labubu_emoji_1_64x64.png'
      import labubu1_128 from './assets/labubu_emoji_1_128x128.png'
      import labubu1_256 from './assets/labubu_emoji_1_256x256.png'
      import labubu1_512 from './assets/labubu_emoji_1_512x512.png'
      import labubu2_64 from './assets/labubu_emoji_2_64x64.png'
      import labubu2_128 from './assets/labubu_emoji_2_128x128.png'
      import labubu2_256 from './assets/labubu_emoji_2_256x256.png'
      import labubu2_512 from './assets/labubu_emoji_2_512x512.png'
      import labubu3_64 from './assets/labubu_emoji_3_64x64.png'
      import labubu3_128 from './assets/labubu_emoji_3_128x128.png'
      import labubu3_256 from './assets/labubu_emoji_3_256x256.png'
      import labubu3_512 from './assets/labubu_emoji_3_512x512.png'
      import labubu4_64 from './assets/labubu_emoji_4_64x64.png'
      import labubu4_128 from './assets/labubu_emoji_4_128x128.png'
      import labubu4_256 from './assets/labubu_emoji_4_256x256.png'
      import labubu4_512 from './assets/labubu_emoji_4_512x512.png'
      import labubu5_64 from './assets/labubu_emoji_5_64x64.png'
      import labubu5_128 from './assets/labubu_emoji_5_128x128.png'
      import labubu5_256 from './assets/labubu_emoji_5_256x256.png'
      import labubu5_512 from './assets/labubu_emoji_5_512x512.png'
      import labubu6_64 from './assets/labubu_emoji_6_64x64.png'
      import labubu6_128 from './assets/labubu_emoji_6_128x128.png'
      import labubu6_256 from './assets/labubu_emoji_6_256x256.png'
      import labubu6_512 from './assets/labubu_emoji_6_512x512.png'
      import labubu7_64 from './assets/labubu_emoji_7_64x64.png'
      import labubu7_128 from './assets/labubu_emoji_7_128x128.png'
      import labubu7_256 from './assets/labubu_emoji_7_256x256.png'
      import labubu7_512 from './assets/labubu_emoji_7_512x512.png'
      import labubu8_64 from './assets/labubu_emoji_8_64x64.png'
      import labubu8_128 from './assets/labubu_emoji_8_128x128.png'
      import labubu8_256 from './assets/labubu_emoji_8_256x256.png'
      import labubu8_512 from './assets/labubu_emoji_8_512x512.png'

      let selectedEmoji = null
      let selectedEmojiName = 'art'
      let currentSize = 512 // Default size
      
      // ÂàõÂª∫Ëá™ÂÆö‰πâÂàÜÁ±ªÂíåË°®ÊÉÖÁ¨¶Âè∑
      const custom = [
        {
          id: 'labubu_category',
          name: 'Labubu',
          emojis: [

            {
              id: 'labubu1',
              name: 'Labubu 1',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu1,
                downloads: {
                  '64': labubu1_64,
                  '128': labubu1_128,
                  '256': labubu1_256,
                  '512': labubu1_512,
                },
              }],
            },
            {
              id: 'labubu2',
              name: 'Labubu 2',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu2,
                downloads: {
                  '64': labubu2_64,
                  '128': labubu2_128,
                  '256': labubu2_256,
                  '512': labubu2_512,
                },
              }],
            },
            {
              id: 'labubu3',
              name: 'Labubu 3',
              keywords: ['labubu', 'cute', 'character'],
              skins: [{
                src: labubu3,
                downloads: {
                  '64': labubu3_64,
                  '128': labubu3_128,
                  '256': labubu3_256,
                  '512': labubu3_512,
                },
              }],
            },
             {
               id: 'labubu4',
               name: 'Labubu 4',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu4,
                 downloads: {
                   '64': labubu4_64,
                   '128': labubu4_128,
                   '256': labubu4_256,
                   '512': labubu4_512,
                 },
               }],
             },
             {
               id: 'labubu5',
               name: 'Labubu 5',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu5,
                 downloads: {
                   '64': labubu5_64,
                   '128': labubu5_128,
                   '256': labubu5_256,
                   '512': labubu5_512,
                 },
               }],
             },
             {
               id: 'labubu6',
               name: 'Labubu 6',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu6,
                 downloads: {
                   '64': labubu6_64,
                   '128': labubu6_128,
                   '256': labubu6_256,
                   '512': labubu6_512,
                 },
               }],
             },
             {
               id: 'labubu7',
               name: 'Labubu 7',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu7,
                 downloads: {
                   '64': labubu7_64,
                   '128': labubu7_128,
                   '256': labubu7_256,
                   '512': labubu7_512,
                 },
               }],
             },
             {
               id: 'labubu8',
               name: 'Labubu 8',
               keywords: ['labubu', 'cute', 'character'],
               skins: [{
                 src: labubu8,
                 downloads: {
                   '64': labubu8_64,
                   '128': labubu8_128,
                   '256': labubu8_256,
                   '512': labubu8_512,
                 },
               }],
             },

          ]
        }
      ]
      
      const picker = new Picker({
        parent: document.querySelector('#picker'),
        data: data,
        custom: custom,
        categories: ['labubu_category', 'frequent', 'people', 'nature', 'foods', 'activity', 'places', 'objects', 'symbols', 'flags'],
        emojiButtonRadius: '6px',
        emojiButtonColors: [
          'rgba(155,223,88,.7)',
          'rgba(149,211,254,.7)',
          'rgba(247,233,34,.7)',
          'rgba(238,166,252,.7)',
          'rgba(255,213,143,.7)',
          'rgba(211,209,255,.7)',
        ],
        onEmojiSelect: onEmojiSelect,
      })

      function generateEmojiImage(emoji, size) {
        // Â§ÑÁêÜËá™ÂÆö‰πâË°®ÊÉÖÁ¨¶Âè∑
        if (emoji && emoji.skins && emoji.skins[0] && emoji.skins[0].src) {
          // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÂõæÂÉèÂÖÉÁ¥†Êù•Âä†ËΩΩËá™ÂÆö‰πâË°®ÊÉÖÁ¨¶Âè∑
          return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = size;
              canvas.height = size;
              
              // ËÆæÁΩÆÈ´òË¥®ÈáèÊ∏≤Êüì
              ctx.imageSmoothingEnabled = true;
              ctx.imageSmoothingQuality = 'high';
              
              // Ê∏ÖÈô§ÁîªÂ∏ÉÔºåËÆæÁΩÆÈÄèÊòéËÉåÊôØ
              ctx.clearRect(0, 0, size, size);
              
              // ÁªòÂà∂Ë°®ÊÉÖÁ¨¶Âè∑ÂõæÂÉè
              ctx.drawImage(img, 0, 0, size, size);
              
              resolve(canvas.toDataURL('image/png'));
            };
            img.onerror = () => {
              // Â¶ÇÊûúÂõæÂÉèÂä†ËΩΩÂ§±Ë¥•ÔºåÂàôËøîÂõûÈªòËÆ§ÂõæÂÉè
              resolve('./assets/labubu_emoji_256x256.png');
            };
            img.src = emoji.skins[0].src;
          });
        }
        
        // Â§ÑÁêÜÊ†áÂáÜË°®ÊÉÖÁ¨¶Âè∑
        if (emoji && emoji.native) {
          const canvas = document.createElement('canvas')
          const ctx = canvas.getContext('2d')
          canvas.width = size
          canvas.height = size
          
          // Set high-quality rendering
          ctx.imageSmoothingEnabled = true
          ctx.imageSmoothingQuality = 'high'
          
          // Use appropriate font size for the canvas size
          ctx.font = `${size * 0.8}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Android Emoji", Arial`
          ctx.textAlign = 'center'
          ctx.textBaseline = 'middle'
          
          // Clear canvas with transparent background
          ctx.clearRect(0, 0, size, size)
          
          // Draw emoji
          ctx.fillText(emoji.native, size / 2, size / 2)
          
          return canvas.toDataURL('image/png')
        }
        return './assets/labubu_emoji_256x256.png'
      }

      function onEmojiSelect(emoji) {
        const downloadBtn = document.getElementById('download-btn')

        if (emoji) {
          // Find the full emoji object from our custom list, as emoji-mart strips extra properties.
          let fullEmojiObject = null
          for (const category of custom) {
            const found = category.emojis.find(
              (customEmoji) => customEmoji.id === emoji.id,
            )
            if (found) {
              fullEmojiObject = found
              break
            }
          }

          // If it's a custom emoji, use our full object which includes the 'downloads' property.
          // Otherwise, use the object from emoji-mart (for standard emojis).
          selectedEmoji = fullEmojiObject || emoji

          selectedEmojiName = (emoji.id || emoji.name || 'emoji').replace(/ /g, '_')
          downloadBtn.disabled = false
        } else {
          selectedEmoji = null
          selectedEmojiName = ''
          downloadBtn.disabled = true
        }
        updatePreview()
      }

      function updatePreview() {
        const previewImg = document.getElementById('preview-image')
        const downloadBtn = document.getElementById('download-btn')
        const downloadSpan = downloadBtn.querySelector('span')
        const sizeSelect = document.getElementById('size-select')

        currentSize = parseInt(sizeSelect.value)

        if (selectedEmoji) {
          previewImg.style.width = `${currentSize}px`
          previewImg.style.height = `${currentSize}px`
          // Êõ¥Êñ∞altÂíåtitleÂ±ûÊÄß‰ª•ÊèêÈ´òSEOÂíåÊó†ÈöúÁ¢çÊÄß
          const emojiName = selectedEmoji.name || selectedEmojiName || 'emoji';
          previewImg.alt = `${emojiName} emoji preview at ${currentSize}x${currentSize} pixels`;
          previewImg.title = `${emojiName} emoji - Click download button to save as PNG`;
          
          if (selectedEmoji.skins && selectedEmoji.skins[0] && selectedEmoji.skins[0].downloads && selectedEmoji.skins[0].downloads[currentSize]) {
            previewImg.src = selectedEmoji.skins[0].downloads[currentSize];
          } else if (selectedEmoji.skins && selectedEmoji.skins[0] && selectedEmoji.skins[0].src) {
            previewImg.src = selectedEmoji.skins[0].src
          } else {
            const imageResult = generateEmojiImage(selectedEmoji, currentSize)
            if (imageResult instanceof Promise) {
              imageResult.then((imageData) => {
                previewImg.src = imageData
              }).catch(() => {
                previewImg.src = './assets/labubu_emoji_256x256.png'
              })
            } else {
              previewImg.src = imageResult
            }
          }
          downloadSpan.textContent = `Download ${selectedEmojiName}_${currentSize}x${currentSize}.png`
          downloadBtn.disabled = false
          downloadBtn.setAttribute('aria-label', `Download ${selectedEmojiName} emoji as ${currentSize}x${currentSize} PNG image`)
          downloadBtn.title = `Download ${selectedEmojiName} emoji as ${currentSize}x${currentSize} PNG image`
        } else {
          previewImg.src = ''
          previewImg.alt = 'Select an emoji to preview'
          previewImg.title = 'No emoji selected yet'
          previewImg.style.width = 'auto'
          previewImg.style.height = 'auto'
          downloadSpan.textContent = 'Download'
          downloadBtn.disabled = true
          downloadBtn.setAttribute('aria-label', 'Download button (select an emoji first)')
          downloadBtn.title = 'Select an emoji first'
        }
      }

      // Initialize button text on page load
      document.addEventListener('DOMContentLoaded', () => {
        const previewImg = document.getElementById('preview-image')
        const downloadBtn = document.getElementById('download-btn')
        const downloadSpan = downloadBtn.querySelector('span')
        const sizeSelect = document.getElementById('size-select')
        const searchInput = document.getElementById('emoji-search')
        currentSize = parseInt(sizeSelect.value)

        // Ê£ÄÊü• URL ‰∏≠ÊòØÂê¶ÊúâÊêúÁ¥¢ÂèÇÊï∞
        const searchString = window.location.search
        let searchQuery = ''
        
        // Â§ÑÁêÜ ?=ÂÖ≥ÈîÆËØç Ê†ºÂºèÁöÑ URL
        if (searchString.startsWith('?=')) {
          searchQuery = decodeURIComponent(searchString.substring(2))
          
          if (searchQuery) {
            // ËÆæÁΩÆÊêúÁ¥¢Ê°ÜÁöÑÂÄº
            searchInput.value = searchQuery
            // Ëß¶ÂèëÊêúÁ¥¢Âπ∂Ëá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™ emoji
            triggerSearch(searchQuery)
          }
        }
        
        // Set the initial emoji to Labubu 1
        selectedEmoji = custom[0].emojis[0];
        selectedEmojiName = selectedEmoji.id;

        // Update the preview to show the default emoji with the correct size
        updatePreview();

        previewImg.alt = 'Select an emoji to preview'
        if (selectedEmojiName) {
          downloadSpan.textContent = `Download ${selectedEmojiName}_${currentSize}x${currentSize}.png`
          downloadBtn.disabled = false
        } else {
          downloadSpan.textContent = 'Download'
          downloadBtn.disabled = true
        }
      })

      // Size selector change handler
      document.getElementById('size-select').addEventListener('change', updatePreview)

      // Download functionality
      document.getElementById('download-btn').addEventListener('click', () => {
        const sizeSelect = document.getElementById('size-select')
        const selectedSize = parseInt(sizeSelect.value)

        const processDownload = (imageData) => {
          const link = document.createElement('a')
          link.download = `${selectedEmojiName}_${selectedSize}x${selectedSize}.png`
          link.href = imageData
          link.click()
        }

        if (selectedEmoji) {
          if (
            selectedEmoji.skins &&
            selectedEmoji.skins[0] &&
            selectedEmoji.skins[0].downloads &&
            selectedEmoji.skins[0].downloads[selectedSize]
          ) {
            processDownload(selectedEmoji.skins[0].downloads[selectedSize])
          } else {
            // Fallback for other emojis or sizes not specified
            const imageResult = generateEmojiImage(selectedEmoji, selectedSize)
            if (imageResult instanceof Promise) {
              imageResult.then(processDownload)
            } else {
              processDownload(imageResult)
            }
          }
        } else {
          // Use default image
          processDownload('./assets/labubu_emoji_256x256.png')
        }
      })

      // ÊêúÁ¥¢ÂäüËÉΩ - Â¢ûÂº∫ÁâàÔºåÊîØÊåÅÊó†ÈöúÁ¢çËÆøÈóÆÂíåSEO‰ºòÂåñ
      const searchInput = document.getElementById('emoji-search')
      
      // Ê∑ªÂä†ARIAÂ±ûÊÄß‰ª•ÊèêÈ´òÊó†ÈöúÁ¢çÊÄß
      searchInput.setAttribute('aria-controls', 'picker')
      searchInput.setAttribute('aria-autocomplete', 'list')
      
      // Ê®°Êãüemoji-martÂÜÖÈÉ®ÊêúÁ¥¢ËæìÂÖ•Âπ∂Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™ÊêúÁ¥¢ÁªìÊûú‰Ωú‰∏∫È¢ÑËßà
      const triggerSearch = (searchTerm) => {
        // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò‰ª•ÂèçÊò†ÊêúÁ¥¢Áä∂ÊÄÅÔºåÊúâÂà©‰∫éSEO
        if (searchTerm) {
          document.title = `${searchTerm} Emoji - Search Results | EmojiToImage.com`
        } else {
          document.title = `Emoji To Image - Search An Emoji and Convert It As An Image.`
        }
        
        const pickerElement = document.querySelector('em-emoji-picker')
        if (pickerElement && pickerElement.shadowRoot) {
          const internalSearchInput = pickerElement.shadowRoot.querySelector('input[type="search"]')
          if (internalSearchInput) {
            internalSearchInput.value = searchTerm
            // Ëß¶Âèëinput‰∫ã‰ª∂
            const inputEvent = new Event('input', { bubbles: true })
            internalSearchInput.dispatchEvent(inputEvent)
            
            // Ê∑ªÂä†Âª∂Êó∂‰ª•Á°Æ‰øùÊêúÁ¥¢ÁªìÊûúÂ∑≤Êõ¥Êñ∞
            setTimeout(() => {
              // Ëé∑ÂèñÊêúÁ¥¢ÁªìÊûú‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™emoji
              const firstEmojiButton = pickerElement.shadowRoot.querySelector('.emoji-mart-emoji')
              if (firstEmojiButton && searchTerm) {
                // ÊîæÂ§ßÊòæÁ§∫Á¨¨‰∏Ä‰∏™emoji
                firstEmojiButton.style.transform = 'scale(1.3)';
                
                // 2ÁßíÂêéÊÅ¢Â§çÊ≠£Â∏∏Ê†∑Âºè
                setTimeout(() => {
                  firstEmojiButton.style.transform = '';
                }, 2000);
                
                // Ëé∑ÂèñemojiÊï∞ÊçÆ
                const emojiId = firstEmojiButton.getAttribute('data-emoji-id')
                const emojiName = firstEmojiButton.getAttribute('data-emoji-name')
                
                // Êü•ÊâæÂÆåÊï¥ÁöÑemojiÂØπË±°
                let foundEmoji = null
                
                // È¶ñÂÖàÂú®Ëá™ÂÆö‰πâemoji‰∏≠Êü•Êâæ
                for (const category of custom) {
                  const found = category.emojis.find(
                    (customEmoji) => customEmoji.id === emojiId || customEmoji.name === emojiName
                  )
                  if (found) {
                    foundEmoji = found
                    break
                  }
                }
                
                // Â¶ÇÊûúÂú®Ëá™ÂÆö‰πâemoji‰∏≠Ê≤°ÊâæÂà∞ÔºåÂàôÂèØËÉΩÊòØÊ†áÂáÜemoji
                if (!foundEmoji) {
                  // Ê®°ÊãüÁÇπÂáªÁ¨¨‰∏Ä‰∏™emoji‰ª•Ëé∑ÂèñÂÖ∂Êï∞ÊçÆ
                  firstEmojiButton.click()
                  return
                }
                
                // ËÆæÁΩÆ‰∏∫ÈÄâ‰∏≠ÁöÑemojiÂπ∂Êõ¥Êñ∞È¢ÑËßà
                onEmojiSelect(foundEmoji)
              }
            }, 300) // 300msÂª∂Êó∂‰ª•Á°Æ‰øùÊêúÁ¥¢ÁªìÊûúÂ∑≤Êõ¥Êñ∞
          }
        }
      }
      
      searchInput.addEventListener('input', function(event) {
        const searchTerm = event.target.value
        triggerSearch(searchTerm)
        
        // Êõ¥Êñ∞ URLÔºåÂú® URL ÂêéÈù¢Ê∑ªÂä† ?=ÂÖ≥ÈîÆËØç
        const newUrl = searchTerm
          ? `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}` 
          : `${window.location.origin}${window.location.pathname}`
        window.history.replaceState({}, '', newUrl)
      })
      
      // Ê∏ÖÈô§ÊêúÁ¥¢Êó∂ÈáçÁΩÆ
      searchInput.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          event.target.value = ''
          triggerSearch('')
          // ÈáçÁΩÆ URL
          window.history.replaceState({}, '', `${window.location.origin}${window.location.pathname}`)
        }
      })
      
      // Ê∑ªÂä†ÁÉ≠Èó®ÊêúÁ¥¢ÈìæÊé•ÁöÑÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜÂô® - ‰øÆÂ§çÁßªÂä®Á´ØÁÇπÂáªÊó†ÂìçÂ∫îÈóÆÈ¢ò
      document.querySelectorAll('.hot-search a').forEach(link => {
        // Ê∑ªÂä†Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅÁßªÂä®Á´Ø
        link.addEventListener('touchstart', function(event) {
          // Èò≤Ê≠¢Ëß¶Êë∏Êó∂ÁöÑÈªòËÆ§Ë°å‰∏∫
          event.preventDefault()
        })
        
        link.addEventListener('click', function(event) {
          event.preventDefault() // Èò≤Ê≠¢È°µÈù¢ÈáçÊñ∞Âä†ËΩΩ
          
          const href = this.getAttribute('href')
          const searchTerm = href.startsWith('?=') ? decodeURIComponent(href.substring(2)) : ''
          
          if (searchTerm) {
            // ËÆæÁΩÆÊêúÁ¥¢Ê°ÜÁöÑÂÄº
            searchInput.value = searchTerm
            // Ëß¶ÂèëÊêúÁ¥¢
            triggerSearch(searchTerm)
            // Êõ¥Êñ∞ URL
            const newUrl = `${window.location.origin}${window.location.pathname}?=${encodeURIComponent(searchTerm)}`
            window.history.replaceState({}, '', newUrl)
          }
        })
        
        // Ê∑ªÂä†Ëß¶Êë∏ÁªìÊùü‰∫ã‰ª∂Â§ÑÁêÜ
        link.addEventListener('touchend', function(event) {
          event.preventDefault()
          // Ëß¶ÂèëÁÇπÂáª‰∫ã‰ª∂
          this.click()
        })
      })
    </script>
  </block>
</extends>
