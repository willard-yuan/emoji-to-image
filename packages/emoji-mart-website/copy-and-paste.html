<extends
  src="layout.html"
  locals='{ "exampleName": "Emoji to Copy", "exampleFile": "copy-and-paste.html" }'
>
  <block name="download_section"></block>

  <block name="script">
    <style>
      /* 单列布局覆盖 */
      .main-content {
        display: block;
        grid-template-columns: none;
        gap: 2rem;
      }
      
      .picker-section {
        padding: 2rem 0;
        margin-top: 2rem;
        position: relative;
      }
      
      em-emoji-picker {
        /* Mobile-first responsive styles */
        width: 100%;
        max-width: 100%;
        min-width: 250px;
        resize: horizontal;
        overflow: auto;
        margin: 0 auto;
      }

      @media (min-width: 820px) {
        em-emoji-picker {
          width: auto;
          min-width: 800px;
        }
      }
      
      /* 复制提示框样式 */
      .copied-toast {
        position: absolute;
        background-color: white;
        color: #333;
        padding: 8px 15px;
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
    </style>
    <script type="module">
      import data from '@emoji-mart/data'
      import { Picker } from 'emoji-mart'

      // 创建复制提示框元素
      const createCopiedToast = () => {
        const toast = document.createElement('div');
        toast.className = 'copied-toast';
        toast.textContent = 'Copied!';
        toast.style.opacity = '0';
        document.querySelector('.picker-section').appendChild(toast);
        return toast;
      };
      
      // 显示复制提示框
      const showCopiedToast = (toast, x, y) => {
        const pickerSection = document.querySelector('.picker-section');
        const rect = pickerSection.getBoundingClientRect();

        // 计算相对于.picker-section的坐标
        const relativeX = x - rect.left;
        const relativeY = y - rect.top;

        // 将提示框居中在点击位置上方
        toast.style.left = `${relativeX - toast.offsetWidth / 2}px`;
        toast.style.top = `${relativeY - toast.offsetHeight - 10}px`; // 在上方留出10px的间距
        toast.style.opacity = '1';
        
        // 2秒后隐藏
        setTimeout(() => {
          toast.style.opacity = '0';
        }, 2000);
      };
      
      // 复制文本到剪贴板
      const copyToClipboard = async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (err) {
          console.error('复制失败:', err);
          return false;
        }
      };
      
      document.addEventListener('DOMContentLoaded', function() {
        // 修改页面标题和描述
        const h1 = document.querySelector('h1');
        if (h1) {
          h1.textContent = 'Emoji to Copy & Paste';
        }

        const p = document.querySelector('header p');
        if (p) {
          p.textContent = 'Choose or search an emoji and click the emoji to get it copied, then you can paste it everywhere!';
        }
        
        // 创建复制提示框
        const copiedToast = createCopiedToast();
        
        // 跟踪最后点击的位置
        let lastClickX = 0;
        let lastClickY = 0;
        
        // 添加全局点击事件监听器来捕获点击位置
        document.addEventListener('click', function(event) {
          lastClickX = event.clientX;
          lastClickY = event.clientY;
        }, true); // 使用捕获阶段以确保在其他处理程序之前执行
        
        // 初始化emoji选择器
        new Picker({
          parent: document.querySelector('#picker'),
          data: data,
          dynamicWidth: true,
          onEmojiSelect: async (emoji) => {
            // 复制emoji到剪贴板
            const success = await copyToClipboard(emoji.native || emoji.id);
            
            if (success) {
              // 显示复制成功提示在最后点击的位置
              showCopiedToast(copiedToast, lastClickX, lastClickY);
            }
          }
        });
      });
    </script>
  </block>
</extends>
